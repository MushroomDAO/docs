
### **技术可行性分析：Mycelium MVP 的浏览器内硬件调用**

**致：** Mycelium 协议 DAO，技术委员会
**发件人：** [您的姓名]，项目负责人
**日期：** 2025 年 7 月 7 日
**主题：** 针对基于摄像头的二维码扫描和生物识别认证的 Web API 评估

#### **1. 执行摘要**

本文件旨在对 Mycelium MVP（最小可行产品）所需的两项关键技术进行技术评估：
1.  **浏览器内摄像头调用**，用于扫描二维码。
2.  **浏览器内生物识别认证**（特别是指导纹识别），用于保障用户操作安全。

分析结论是，这两项技术都已成熟，被现代移动浏览器广泛支持，并受到健全的安全标准制约，因此非常适合我们的项目。项目的主要挑战不在于使用这些功能的可行性，而在于如何正确且用户友好地实现它们。

---

#### **2. 用于二维码扫描的浏览器内摄像头调用**

让我们的网页版 MVP 能够在浏览器中直接扫描商家的 PromptPay 二维码，而无需强制用户立即下载 App，这对于降低用户使用门槛至关重要。

##### **2.1. 核心技术：`getUserMedia` API**

实现此功能的主要 Web 标准是`MediaDevices.getUserMedia()`方法 [1]。这个 JavaScript API 允许网页请求访问用户的媒体输入设备，例如摄像头和麦克风 [1]。

*   **工作原理：** 当调用此 API 时，它会提示用户授权使用其摄像头。如果用户授予权限，API 将返回一个`MediaStream`对象，这本质上是一个来自摄像头的实时视频流。这个视频流随后可以被渲染到网页上的一个`<video>`元素中，并由一个二维码解码库进行实时分析 [2, 3]。

##### **2.2. 可行性与浏览器兼容性**

`getUserMedia` API 是一个非常成熟的 Web 标准，在绝大多数现代移动浏览器上都得到了极好的支持 [1]。

*   **广泛支持：** 根据`caniuse.com`的数据，该 API 得到了安卓版 Chrome、iOS 版 Safari（自 11 版起）、三星互联网浏览器以及安卓版 Firefox 的支持 [4, 5, 6]。全球使用统计数据显示，超过 94% 的浏览器支持此功能 [6]。如此高的兼容性确保了我们的网页版 MVP 能够被绝大多数目标用户在其移动设备上访问。

##### **2.3. 安全与用户授权模型**

浏览器供应商围绕这个强大的 API 实施了严格的安全和隐私控制，这有助于我们建立用户信任 [1]。

1.  **强制安全上下文（HTTPS）：** `getUserMedia` API**只能**在通过安全连接（HTTPS）加载的页面上调用 [1]。任何在不安全（HTTP）页面上使用它的尝试都会失败。这是一个基础的安全要求，可以防止中间人攻击 [7]。
2.  **需要用户明确授权：** 网站不能静默访问摄像头。浏览器总会向用户显示一个清晰的、不可绕过的权限提示框，询问他们是否允许该特定网站访问其摄像头 [1]。用户必须明确授予此权限。
3.  **清晰的视觉指示：** 当摄像头被激活时，所有现代移动浏览器都会在状态栏或地址栏中显示一个持久的图标，并且设备的硬件指示灯（如果有）也会被点亮。这种透明性使得网站极难在用户不知情的情况下访问摄像头 [8]。

##### **2.4. 实施策略**

虽然`getUserMedia` API 提供了视频流，我们仍需要从该流中解码出二维码。与其从零开始构建解码器，我们将利用一个维护良好的开源 JavaScript 库。

*   **推荐库：** `html5-qrcode`是一个绝佳的选择 [9, 10]。它是一个功能齐全的库，处理了整个流程：请求摄像头权限、将视频流渲染到 UI 元素中，以及解码包括二维码在内的多种条码格式 [9, 10]。它拥有详尽的文档并且正在积极维护中 [9, 11, 12]。
*   **备选方案：** 对于性能要求更高的应用，Nimiq 开发的`qr-scanner`是一个轻量级的替代品，但可能需要更多的手动 UI 集成工作 [10, 13]。

**摄像头调用结论：** 用于实现浏览器内二维码扫描的技术已经成熟、安全且广泛可用。我们的 MVP 可以可靠地提供此功能，以创造一个无摩擦的初次支付体验。

---

#### **3. 浏览器内指纹认证**

为了在不增加密码输入摩擦的情况下，增强重要操作（例如，确认支付、授权大额充值）的安全性，我们可以利用设备上的生物识别功能，如指纹扫描。

##### **3.1. 核心技术：WebAuthn (Web Authentication API)**

WebAuthn 是一个 W3C 的 Web 标准，它允许使用公钥密码学进行无密码认证 [7, 14, 15, 16, 17, 18, 19, 20]。它是 FIDO2 项目的核心组成部分。

*   **工作原理：**
    1.  **注册：** 当用户选择加入时，浏览器会指示设备的安全硬件（“认证器”，例如安卓的 Keystore、苹果的安全隔区）为我们的网站生成一个独一无二的公私钥对 [14, 21]。
    2.  **私钥永远不会离开设备**。它被安全地存储，并且只能通过用户的生物识别手势（指纹、面部）或设备 PIN 码来解锁 [17, 21]。
    3.  **公钥**被发送到我们的服务器，并与用户账户关联 [21]。
    4.  **认证：** 为了确认一笔支付，我们的服务器会向浏览器发送一个唯一的“挑战（challenge）”。浏览器将其传递给认证器。用户通过指纹进行认证，从而解锁私钥来对这个“挑战”进行签名。这个签过名的挑战被发送回我们的服务器，服务器用存储的公钥进行验证 [14, 21, 22]。

##### **3.2. 安全性评估：对密码的范式转变**

相比传统密码，WebAuthn 提供了巨大的安全升级。

1.  **抗钓鱼：** 密钥对的作用域被限定在特定的域名 [20, 21]。一个为`app.mycelium.io`注册的密钥对，不能被用于为一个钓鱼网站`app.myceluim.io`的挑战签名，这使得通过钓鱼窃取凭证几乎不可能 [17, 19]。
2.  **服务器端无共享秘密：** 我们从不存储密码或私钥。即使我们的数据库被攻破，也没有可以被盗用来冒充用户的凭证 [17]。
3.  **无重放攻击：** 每次认证的“挑战”对于该特定会话都是唯一的，这意味着被截获的签名无法被攻击者重用 [17]。

##### **3.3. 可行性与浏览器兼容性**

WebAuthn 现已在现代 Web 生态系统中得到广泛支持，全球浏览器支持率超过 95% [23]。

*   **桌面与移动端支持：** 它得到了桌面和移动平台上的 Chrome、Safari、Edge 和 Firefox 的支持 [23, 24]。
*   **平台认证器支持：** 对我们的用例至关重要的是，它支持“平台认证器”——即直接内置于设备中的生物识别传感器 [18, 20, 25, 26]。这包括：
    *   **安卓：** 指纹传感器和屏幕锁定。
    *   **iOS (14.5+):** 触控 ID 和面容 ID。
    *   **Windows 10/11:** Windows Hello（指纹、面部）。
    *   **macOS:** 触控 ID。

**生物识别认证结论：** WebAuthn 是一个高度安全、被广泛采用的标准，对于我们的 MVP 来说在技术上是完全可行的。它使我们能够提供一种比传统 PIN 码或密码更安全、更便捷的用户体验来确认交易。通过使用专门的库和服务，其实现复杂性是可控的。